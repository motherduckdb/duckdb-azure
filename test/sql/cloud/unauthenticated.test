# name: test/sql/cloud/unauthenticated.test
# description: test unauthenticated queries
# group: [cloud]

require azure

require parquet

require-env DUCKDB_AZURE_PUBLIC_CONTAINER_AVAILABLE

require-env PUBLIC_AZ_STORAGE_ACCOUNT

statement ok
set allow_persistent_secrets=false

# Using fully qualified url
query I nosort r1
FROM 'az://${PUBLIC_AZ_STORAGE_ACCOUNT}.blob.core.windows.net/testing-public/l.parquet';

# Using a secret to set the account name, we can omit the fully qualified url
statement ok
CREATE SECRET s1 (TYPE AZURE, ACCOUNT_NAME '${PUBLIC_AZ_STORAGE_ACCOUNT}')

query I nosort r1
FROM 'az://testing-public/l.parquet';

query I nosort r1
FROM './data/l.parquet'

## Testing network activity
statement ok
SET azure_http_stats = true;
